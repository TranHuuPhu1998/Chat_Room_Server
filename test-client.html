<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Socket.io Test Client</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .container {
            border: 1px solid #ccc;
            padding: 20px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .messages {
            height: 200px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 10px;
            margin: 10px 0;
            background-color: #f9f9f9;
        }
        input, button {
            padding: 8px;
            margin: 5px;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 3px;
        }
        .connected {
            background-color: #d4edda;
            color: #155724;
        }
        .disconnected {
            background-color: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <h1>Chat Room Server - Socket.io Test Client</h1>
    
    <div id="status" class="status disconnected">Disconnected</div>
    
    <div class="container">
        <h3>Connection</h3>
        <button onclick="connect()">Connect</button>
        <button onclick="disconnect()">Disconnect</button>
    </div>
    
    <div class="container">
        <h3>Room Management</h3>
        <input type="text" id="roomInput" placeholder="Enter room ID (e.g., student-1234567890)" />
        <button onclick="joinRoom()">Join Room</button>
        <button onclick="leaveRoom()">Leave Room</button>
    </div>
    
    <div class="container">
        <h3>Messages</h3>
        <div id="messages" class="messages"></div>
        <input type="text" id="messageInput" placeholder="Enter message" />
        <input type="text" id="senderInput" placeholder="Enter sender name" />
        <button onclick="sendMessage()">Send Message</button>
    </div>
    
    <div class="container">
        <h3>Test Socket.io Events</h3>
        <button onclick="testAddStudent()">Add Student via Socket</button>
        <button onclick="testAssignLesson()">Assign Lesson via Socket</button>
        <button onclick="testCreateAccessCode()">Create Access Code via Socket</button>
        <button onclick="testVerifyAccessCode()">Verify Access Code via Socket</button>
    </div>

    <script>
        let socket = null;
        let currentRoom = null;

        function connect() {
            socket = io('http://localhost:8080');
            
            socket.on('connect', () => {
                updateStatus('Connected', 'connected');
                addMessage('Connected to server');
            });
            
            socket.on('disconnect', () => {
                updateStatus('Disconnected', 'disconnected');
                addMessage('Disconnected from server');
            });
            
            socket.on('user-joined', (data) => {
                addMessage(`User ${data.userId} joined the room`);
            });
            
            socket.on('user-left', (data) => {
                addMessage(`User ${data.userId} left the room`);
            });
            
            socket.on('receive-message', (data) => {
                addMessage(`[${data.sender}]: ${data.message} (${data.timestamp})`);
            });
            
            socket.on('student-added', (data) => {
                addMessage(`New student added: ${data.student.name} (${data.student.phone})`);
            });
            
            socket.on('lesson-assigned', (data) => {
                addMessage(`Lesson assigned: ${data.lesson.title}`);
            });
            
            socket.on('lesson-added', (data) => {
                addMessage(`New lesson added for student ${data.studentPhone}: ${data.lesson.title}`);
            });
            
            socket.on('access-code-sent', (data) => {
                addMessage(`Access code sent to ${data.phoneNumber}`);
            });
            
            socket.on('access-code-verified', (data) => {
                addMessage(`Access code verification for ${data.phoneNumber}: ${data.isValid ? 'Valid' : 'Invalid'}`);
            });
            
            // Success event handlers
            socket.on('add-student-success', (data) => {
                addMessage(`Student added successfully: ${data.student.name}`);
            });
            
            socket.on('assign-lesson-success', (data) => {
                addMessage(`Lesson assigned successfully: ${data.lesson.title}`);
            });
            
            socket.on('create-access-code-success', (data) => {
                addMessage(`Access code created: ${data.message}`);
            });
            
            socket.on('verify-access-code-success', (data) => {
                addMessage(`Access code verification result: ${data.isValid ? 'Valid' : 'Invalid'}`);
            });
            
            // Error handler
            socket.on('error', (data) => {
                addMessage(`Error: ${data.message}`);
            });
        }

        function disconnect() {
            if (socket) {
                socket.disconnect();
                socket = null;
            }
        }

        function joinRoom() {
            const roomId = document.getElementById('roomInput').value;
            if (socket && roomId) {
                socket.emit('join-room', roomId);
                currentRoom = roomId;
                addMessage(`Joined room: ${roomId}`);
            }
        }

        function leaveRoom() {
            if (socket && currentRoom) {
                socket.emit('leave-room', currentRoom);
                addMessage(`Left room: ${currentRoom}`);
                currentRoom = null;
            }
        }

        function sendMessage() {
            const message = document.getElementById('messageInput').value;
            const sender = document.getElementById('senderInput').value;
            if (socket && currentRoom && message && sender) {
                socket.emit('send-message', {
                    roomId: currentRoom,
                    message: message,
                    sender: sender
                });
                addMessage(`[You]: ${message}`);
                document.getElementById('messageInput').value = '';
            }
        }

        function addMessage(message) {
            const messagesDiv = document.getElementById('messages');
            const messageElement = document.createElement('div');
            messageElement.textContent = message;
            messagesDiv.appendChild(messageElement);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function updateStatus(text, className) {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = text;
            statusDiv.className = `status ${className}`;
        }

        // Test Socket.io functions
        function testAddStudent() {
            if (socket) {
                socket.emit('add-student', {
                    name: 'Test Student',
                    phone: '1234567890',
                    email: 'test@example.com'
                });
                addMessage('Sending add-student event...');
            } else {
                addMessage('Please connect first!');
            }
        }

        function testAssignLesson() {
            if (socket) {
                socket.emit('assign-lesson', {
                    studentPhone: '1234567890',
                    title: 'Test Lesson',
                    description: 'This is a test lesson'
                });
                addMessage('Sending assign-lesson event...');
            } else {
                addMessage('Please connect first!');
            }
        }

        function testCreateAccessCode() {
            if (socket) {
                socket.emit('create-access-code', {
                    phoneNumber: '1234567890'
                });
                addMessage('Sending create-access-code event...');
            } else {
                addMessage('Please connect first!');
            }
        }

        function testVerifyAccessCode() {
            if (socket) {
                socket.emit('verify-access-code', {
                    phoneNumber: '1234567890',
                    code: '123456'
                });
                addMessage('Sending verify-access-code event...');
            } else {
                addMessage('Please connect first!');
            }
        }
    </script>
</body>
</html>
